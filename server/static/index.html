<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World</title>
  <style lang="css">
    #app {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
      }
    }
  </script>
</head>

<body>
  <div id="app"></div>
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);

    const controls = new OrbitControls(camera, renderer.domElement);

    const geometry = new THREE.BoxGeometry(1, 1, 1).toNonIndexed();
    const material = new THREE.MeshBasicMaterial({ vertexColors: true });

    const positionAttribute = geometry.getAttribute('position');

    const colors = [];
    const color = new THREE.Color();

    for (let i = 0; i < positionAttribute.count; i += 3) {
      color.set(Math.random() * 0xffffff);

      // define the same color for each vertex of a triangle

      colors.push(color.r, color.g, color.b);
      colors.push(color.r, color.g, color.b);
      colors.push(color.r, color.g, color.b);
    }
    geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

    const cube = new THREE.Mesh(geometry, material);
    scene.add(cube);

    camera.position.z = 5;
    function animate() {
      requestAnimationFrame(animate);
      cube.rotation.x += 0.01;
      cube.rotation.y += 0.02;
      controls.update();
      renderer.render(scene, camera);
    }
    function initListener() {
      function handleMotionEvent(event) {
        const x = event.accelerationIncludingGravity.x;
        const y = event.accelerationIncludingGravity.y;
        const z = event.accelerationIncludingGravity.z;

        // Do something awesome.
        console.log(`Motion x:${x},y:${y},z:${z}`);
      }
      // rotateDegrees,frontToBack, leftToRight,
      function handleOrientationEvent(event) {
        // alert('是否支持运动检测：' + event.absolute);
        const alpha = event.alpha;
        const beta = event.beta;
        const gamma = event.gamma;
        console.log(`Orientation alpha:${alpha},beta:${beta},gamma:${gamma}`);
      }

      window.addEventListener('devicemotion', handleMotionEvent, true);

      window.addEventListener('deviceorientation', handleOrientationEvent, true);
    }

    window.addEventListener('load', () => {
      const target = document.querySelector('#app');
      target.appendChild(renderer.domElement);
      animate()
      initListener()
    })

  </script>
</body>

</html>